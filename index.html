<!DOCTYPE html>
<!-- MOBILE-FIRST VERTICAL HARD-LOCK -->
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dual.Infodose ¬∑ Hub1 Solar+IA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#050816" />

  <!-- Manifest + √≠cones PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png" />

  <style>
    :root{
      /* Nebula Pro + Base Madeira */
      --bg-top: #07152a;
      --bg-mid: #040718;
      --bg-bottom: #1f0b06;

      --accent-blue: #39c5ff;
      --accent-warm: #ff9a3c;
      --accent-soft: #ffce8a;
      --pill-bg: rgba(10, 18, 36, 0.92);
      --pill-border: rgba(255, 255, 255, 0.12);
      --pill-soft: rgba(9, 16, 31, 0.9);

      --text-main: #f9fbff;
      --text-soft: #c1c7dd;
      --text-muted: #8b92a6;

      --danger: #ff6b81;
      --success: #60f7b3;

      --radius-lg: 32px;
      --radius-md: 22px;
      --radius-pill: 999px;

      --shadow-soft: 0 26px 80px rgba(0,0,0,0.9);
      --shadow-pill: 0 22px 60px rgba(0,0,0,0.85);

      --gap: 14px;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{
      min-height:100vh;
      font-family:-apple-system, system-ui, BlinkMacSystemFont, "SF Pro Text", Inter, Roboto, sans-serif;
      -webkit-font-smoothing:antialiased;
      color:var(--text-main);
      background:radial-gradient(circle at top left, #14254a 0%, #050816 42%, #11070b 80%, #1c0d05 100%);
      transition: background 420ms ease-out, color 220ms ease-out;
    }

    /* moods 24h */
    body[data-mood="madrugada"]{
      background:radial-gradient(circle at 50% -20%, #020218 0%, #050816 45%, #050308 100%);
    }
    body[data-mood="manha"]{
      background:radial-gradient(circle at 0% 0%, #1c3f7a 0%, #050816 46%, #1b0d05 100%);
    }
    body[data-mood="tarde"]{
      background:radial-gradient(circle at 0% 10%, #062743 0%, #140819 38%, #3a1306 80%, #5a2a0d 100%);
    }
    body[data-mood="noite"]{
      background:radial-gradient(circle at 0% -10%, #020616 0%, #050816 45%, #07040b 100%);
    }

    body[data-theme="nebula"] .app{
      background:
        radial-gradient(circle at 0% -20%, rgba(61,122,255,0.24), transparent 60%),
        radial-gradient(circle at 120% 120%, rgba(255,120,55,0.35), transparent 55%),
        linear-gradient(160deg, rgba(12,15,30,0.96), rgba(5,7,16,0.98));
    }
    body[data-theme="madeira"]{
      --accent-blue: #f3b05e;
      --accent-warm: #f7b36b;
      --accent-soft: #ffe3b0;
      --pill-bg: rgba(23, 13, 5, 0.94);
      --pill-soft: rgba(28, 14, 7, 0.94);
    }
    body[data-theme="madeira"] .app{
      background:
        radial-gradient(circle at 0% -20%, rgba(139,96,50,0.45), transparent 60%),
        radial-gradient(circle at 120% 120%, rgba(255,158,94,0.45), transparent 55%),
        linear-gradient(160deg, rgba(22,12,6,0.98), rgba(8,4,2,0.98));
    }

    body{
      display:block;
      padding:18px 16px calc(18px + var(--safe-bottom));
      overflow-x:hidden;
    }

    @keyframes soft-orb-glow {
      0%,100% {
        box-shadow:0 0 14px rgba(255,176,88,0.55);
        transform:translateY(0);
      }
      50% {
        box-shadow:0 0 26px rgba(255,214,160,0.95);
        transform:translateY(-0.5px);
      }
    }
    @keyframes soft-pulse-dot {
      0%,100% {
        box-shadow:0 0 10px rgba(96,247,179,0.9);
        transform:scale(1);
      }
      50% {
        box-shadow:0 0 18px rgba(96,247,179,1);
        transform:scale(1.08);
      }
    }

    .app{
      width:100%;
      max-width:430px;
      margin:0 auto;
      border-radius:36px;
      box-shadow:var(--shadow-soft);
      padding:16px 16px calc(18px + var(--safe-bottom));
      position:relative;
      overflow:hidden;
      isolation:isolate;
      backdrop-filter:blur(18px);
      transition:background 420ms ease-out, box-shadow 260ms ease-out, transform 220ms ease-out;
    }
    .app::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 8% 0%, rgba(77,141,255,0.45), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(255,131,58,0.6), transparent 60%),
        radial-gradient(circle at 50% 120%, rgba(255,230,160,0.26), transparent 60%);
      opacity:0.8;
      filter:blur(10px);
      z-index:-2;
    }
    .app::after{
      content:"";
      position:absolute;
      inset:14px;
      border-radius:30px;
      border:1px solid rgba(255,255,255,0.06);
      box-shadow:0 0 0 1px rgba(255,255,255,0.03) inset;
      pointer-events:none;
      z-index:-1;
    }

    .app-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
    }
    .brand-pill{
      padding:6px 12px;
      border-radius:999px;
      background:rgba(9,16,35,0.92);
      border:1px solid rgba(255,255,255,0.16);
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--text-soft);
      backdrop-filter:blur(10px);
    }
    .mode-pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background:linear-gradient(120deg, rgba(57,197,255,0.28), rgba(255,154,60,0.36));
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      color:#0b0f18;
      font-weight:600;
      cursor:pointer;
      transition:background .2s ease-out, transform .16s ease-out, box-shadow .26s ease-out;
      box-shadow:0 10px 25px rgba(0,0,0,0.6);
    }
    .mode-pill span.dot{
      width:7px;height:7px;border-radius:999px;
      background:var(--success);
      box-shadow:0 0 10px rgba(96,247,179,0.9);
      animation:soft-pulse-dot 2.4s ease-in-out infinite;
    }
    .mode-pill:active{
      transform:scale(0.96) translateY(1px);
      box-shadow:0 6px 15px rgba(0,0,0,0.7);
    }

    .app-main{
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }

    /* HERO */
    .hero-card{
      border-radius:var(--radius-lg);
      background:radial-gradient(circle at top left, rgba(46,115,255,0.55), rgba(18,37,82,0.72) 40%, rgba(13,19,40,0.92) 80%);
      box-shadow:var(--shadow-pill);
      padding:16px 16px 14px;
      border:1px solid rgba(144,184,255,0.35);
      position:relative;
      overflow:hidden;
      backdrop-filter:blur(18px);
      transition:border-color .22s ease-out, box-shadow .22s ease-out, background .22s ease-out, transform .18s ease-out;
    }
    .hero-card::before{
      content:"";
      position:absolute;
      inset:-25%;
      background:
        radial-gradient(circle at 0% 0%, rgba(255,255,255,0.25), transparent 55%),
        radial-gradient(circle at 120% 120%, rgba(255,164,92,0.32), transparent 55%);
      opacity:0.32;
      mix-blend-mode:screen;
      pointer-events:none;
    }
    .hero-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:4px;
      position:relative;
      z-index:1;
    }
    .hero-time{
      font-size:12px;
      color:rgba(228,235,255,0.86);
      opacity:.85;
    }
    .hero-voice{
      width:26px;height:26px;border-radius:999px;
      border:1px solid rgba(255,255,255,0.4);
      background:radial-gradient(circle, rgba(7,12,26,0.95), rgba(2,4,12,0.95));
      display:grid;place-items:center;
      color:var(--accent-soft);
      box-shadow:0 0 0 1px rgba(0,0,0,0.65),0 10px 25px rgba(0,0,0,0.7);
      font-size:14px;
      cursor:pointer;
      transition:transform .16s ease-out, box-shadow .2s ease-out, border-color .2s ease-out;
    }
    .hero-voice:active{
      transform:scale(0.94) translateY(1px);
      box-shadow:0 4px 14px rgba(0,0,0,0.8);
      border-color:rgba(255,214,160,0.9);
    }
    .hero-title{
      font-size:22px;
      font-weight:700;
      margin-bottom:2px;
      letter-spacing:.03em;
      position:relative;
      z-index:1;
    }
    .hero-subtitle{
      font-size:13px;
      color:var(--text-soft);
      position:relative;
      z-index:1;
    }
    .hero-slider{
      margin-top:12px;
      position:relative;
      z-index:1;
    }
    .hero-slider-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:11px;
      color:rgba(223,229,255,0.92);
      margin-bottom:6px;
    }
    .hero-slider-row span.label-mood{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(3,8,23,0.9);
      border:1px solid rgba(255,255,255,0.18);
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      backdrop-filter:blur(8px);
    }
    .label-mood i{
      width:6px;height:6px;border-radius:999px;
      background:var(--accent-blue);
      box-shadow:0 0 12px rgba(57,197,255,0.9);
    }
    .range-wrap{
      position:relative;
      width:100%;
      padding-inline:3px;
    }
    .range-track{
      position:absolute;
      left:0;right:0;top:50%;
      height:3px;
      border-radius:999px;
      background:linear-gradient(90deg,#3ac3ff,#ffb35c);
      transform:translateY(-50%);
      opacity:.9;
    }
    .range-fill{
      position:absolute;
      left:0;top:50%;
      height:3px;
      border-radius:999px;
      background:linear-gradient(90deg,#3ac3ff,#ffb35c);
      transform:translateY(-50%) scaleX(0.5);
      transform-origin:left center;
      pointer-events:none;
      transition:transform .18s ease-out;
    }
    .hero-range{
      position:relative;
      width:100%;
      -webkit-appearance:none;
      appearance:none;
      background:transparent;
      outline:none;
      height:30px;
    }
    .hero-range::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:16px;height:16px;
      border-radius:999px;
      border:2px solid rgba(10,10,15,0.85);
      background:#ffd280;
      box-shadow:0 0 0 4px rgba(255,184,89,0.4);
      cursor:pointer;
      transition:box-shadow .18s ease-out, transform .18s ease-out;
    }
    .hero-range:active::-webkit-slider-thumb{
      box-shadow:0 0 0 6px rgba(255,184,89,0.6);
      transform:scale(1.08);
    }
    .hero-range::-moz-range-thumb{
      width:18px;height:18px;border-radius:999px;border:2px solid #050814;background:#ffd280;
    }

    /* STACKS */
    .stacks{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    details.stack{
      border-radius:var(--radius-md);
      background:var(--pill-bg);
      border:1px solid var(--pill-border);
      box-shadow:0 12px 32px rgba(0,0,0,0.7);
      overflow:hidden;
      transition:border-color .22s ease-out, box-shadow .22s ease-out, background .22s ease-out, transform .22s ease-out;
    }
    details.stack[open]{
      border-color:rgba(255,185,104,0.7);
      background:linear-gradient(135deg, rgba(17,19,40,0.98), rgba(40,19,9,0.95));
      box-shadow:0 18px 40px rgba(0,0,0,0.9);
      transform:translateY(-1px);
    }
    summary.stack-summary{
      list-style:none;
      cursor:pointer;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      position:relative;
    }
    summary.stack-summary::-webkit-details-marker{display:none;}

    .stack-main{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .stack-title{
      font-size:15px;
      font-weight:500;
    }
    .stack-sub{
      font-size:11px;
      color:var(--text-muted);
    }
    .stack-meta{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:var(--text-soft);
    }
    .stack-pill{
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--text-muted);
    }
    .stack-icon{
      width:26px;height:26px;border-radius:999px;
      display:grid;place-items:center;
      font-size:15px;
      color:#1b0e03;
      background:radial-gradient(circle, rgba(255,140,80,0.9), rgba(80,34,6,0.1));
      box-shadow:0 0 18px rgba(255,140,80,0.7);
      animation:soft-orb-glow 3s ease-in-out infinite;
    }
    .stack-icon.secondary{
      background:radial-gradient(circle, rgba(143,123,255,0.9), rgba(14,21,60,0.4));
      color:#050816;
    }
    .stack-body{
      border-top:1px solid rgba(255,255,255,0.08);
      background:radial-gradient(circle at 0% 0%, rgba(87,143,255,0.06), transparent 60%),
                 radial-gradient(circle at 120% 150%, rgba(255,140,80,0.18), transparent 60%),
                 var(--pill-soft);
      padding:8px 10px 10px;
    }

    .panel-list{
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .panel-row{
      border-radius:14px;
      padding:9px 10px;
      background:rgba(8,11,25,0.96);
      border:1px solid rgba(255,255,255,0.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      font-size:13px;
      color:var(--text-soft);
      cursor:pointer;
      transition:background .16s ease-out, transform .12s ease-out, box-shadow .18s ease-out, border-color .18s ease-out;
    }
    .panel-row:hover{
      background:rgba(10,14,32,0.98);
      border-color:rgba(255,185,104,0.5);
      box-shadow:0 10px 26px rgba(0,0,0,0.7);
    }
    .panel-row:active{
      transform:scale(0.98) translateY(1px);
      box-shadow:0 4px 12px rgba(0,0,0,0.8);
    }
    .panel-row-main{
      display:flex;
      flex-direction:column;
      gap:1px;
    }
    .panel-row-main strong{
      font-size:14px;
      color:var(--text-main);
    }
    .panel-row-main span.meta{
      font-size:11px;
      color:var(--text-muted);
    }
    .panel-pill{
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.16);
      font-size:11px;
      color:var(--text-soft);
      display:inline-flex;
      align-items:center;
      gap:4px;
      backdrop-filter:blur(6px);
    }
    .panel-pill i{ font-size:12px; }

    .pill-grid{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:6px;
      margin-top:4px;
    }
    .pill-grid .pill{
      border-radius:12px;
      padding:7px 8px;
      background:rgba(8,11,25,0.9);
      border:1px solid rgba(255,255,255,0.09);
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      color:var(--text-soft);
      cursor:pointer;
      transition:background .16s ease-out, transform .12s ease-out, border-color .18s ease-out, box-shadow .18s ease-out;
    }
    .pill-grid .pill:hover{
      background:rgba(10,14,32,0.96);
      border-color:rgba(255,187,104,0.55);
      box-shadow:0 10px 22px rgba(0,0,0,0.75);
    }
    .pill-grid .pill:active{
      transform:scale(0.98) translateY(1px);
    }
    .pill-main{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .pill-main .pill-title{
      font-size:12px;
      color:var(--text-main);
    }
    .pill-main .pill-desc{
      font-size:10px;
      color:var(--text-muted);
    }
    .pill-actions{
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:flex-end;
    }
    .pill-badge{
      font-size:10px;
      opacity:.7;
    }
    .pill-del{
      border:none;
      background:rgba(40,6,6,0.9);
      color:var(--danger);
      border-radius:999px;
      width:18px;height:18px;
      font-size:12px;
      display:grid;place-items:center;
      cursor:pointer;
    }

    .stack-note{
      margin-top:8px;
      font-size:11px;
      color:var(--text-muted);
    }

    /* VIEWERS (Nos.S¬∞lar + C√°psulas) */
    .viewer-shell{
      margin-top:8px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(3,6,18,0.96);
      padding:6px;
      max-height:340px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap:4px;
      transition:max-height .25s ease, border-color .25s ease, box-shadow .25s ease, background .25s ease;
    }
    .viewer-shell.viewer-expanded{
      max-height:80vh;
      border-color:rgba(255,187,104,0.9);
      box-shadow:0 20px 50px rgba(0,0,0,0.9);
      background:radial-gradient(circle at top, rgba(255,200,120,0.14), rgba(3,6,18,0.98));
    }
    .viewer-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      font-size:11px;
      color:var(--text-muted);
    }
    .viewer-header-title{
      text-transform:uppercase;
      letter-spacing:.12em;
    }
    .viewer-toggle{
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.22);
      background:radial-gradient(circle at top, rgba(255,255,255,0.12), rgba(6,9,21,0.96));
      padding:4px 8px;
      font-size:11px;
      color:var(--text-soft);
      display:inline-flex;
      align-items:center;
      gap:4px;
      cursor:pointer;
      transition:background .16s ease-out, transform .12s ease-out, border-color .18s ease-out, box-shadow .18s ease-out;
    }
    .viewer-toggle span.icon{
      font-size:13px;
    }
    .viewer-toggle:active{
      transform:scale(0.96) translateY(1px);
      border-color:rgba(255,187,104,0.8);
      box-shadow:0 8px 18px rgba(0,0,0,0.8);
    }
    .viewer-body{
      border-radius:12px;
      overflow:hidden;
    }
    .viewer-body iframe{
      width:100%;
      height:260px;
      border:none;
      border-radius:12px;
      background:#050715;
      transition:height .25s ease;
    }
    .viewer-shell.viewer-expanded .viewer-body iframe{
      height:72vh;
    }
    .livro-empty,
    .solar-empty{
      font-size:11px;
      color:var(--text-muted);
      padding:6px 4px;
    }

    /* HUB SOLAR */
    .solar-grid{
      display:grid;
      grid-template-columns:repeat(3, minmax(0,1fr));
      gap:6px;
      margin-bottom:6px;
    }
    .solar-card{
      border-radius:12px;
      padding:6px 6px 7px;
      background:rgba(7,10,22,0.96);
      border:1px solid rgba(255,255,255,0.12);
      font-size:11px;
      display:flex;
      flex-direction:column;
      gap:4px;
      cursor:pointer;
      transition:background .16s ease-out, transform .12s ease-out, border-color .18s ease-out, box-shadow .18s ease-out;
    }
    .solar-card:hover{
      background:rgba(10,14,32,0.98);
      border-color:rgba(255,187,104,0.6);
      box-shadow:0 10px 24px rgba(0,0,0,0.8);
    }
    .solar-card:active{
      transform:scale(0.98) translateY(1px);
    }
    .solar-label{
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--text-muted);
      font-size:10px;
    }
    .solar-state{
      display:flex;
      align-items:center;
      gap:4px;
      font-size:11px;
    }
    .solar-dot{
      width:8px;height:8px;border-radius:999px;
      background:var(--success);
      box-shadow:0 0 10px rgba(96,247,179,0.9);
      animation:soft-pulse-dot 2.8s ease-in-out infinite;
    }
    .solar-icon{
      font-size:13px;
      opacity:.9;
    }
    .solar-hash{
      border-radius:12px;
      padding:6px 8px;
      background:rgba(7,9,20,0.98);
      border:1px dashed rgba(255,255,255,0.24);
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      font-size:11px;
      color:var(--text-soft);
      margin-bottom:6px;
    }

    /* CHAT SOLAR / IA */
    .solar-chat{
      margin-top:8px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(4,7,18,0.98);
      padding:6px 7px 8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .solar-chat-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:6px;
      font-size:11px;
      color:var(--text-muted);
    }
    .solar-chat-title{
      text-transform:uppercase;
      letter-spacing:.16em;
      font-size:10px;
    }
    .chat-config{
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:flex-end;
    }
    .chat-config select{
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.24);
      background:rgba(7,10,22,0.98);
      font-size:10px;
      padding:3px 6px;
      color:var(--text-soft);
      max-width:120px;
    }
    .chat-config small{
      font-size:9px;
      color:var(--text-muted);
    }
    .chat-system-box{
      border-radius:10px;
      border:1px dashed rgba(255,255,255,0.22);
      background:rgba(3,6,18,0.96);
      padding:4px 5px;
      font-size:10px;
      color:var(--text-soft);
    }
    .chat-system-box textarea{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text-soft);
      font-size:10px;
      resize:vertical;
      min-height:40px;
      max-height:90px;
    }

    .solar-chat-key{
      display:flex;
      gap:4px;
      align-items:center;
    }
    .solar-chat-key input{
      flex:1;
      min-width:0;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(5,9,22,0.98);
      padding:4px 8px;
      font-size:11px;
      color:var(--text-soft);
    }
    .solar-chat-key button{
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.24);
      background:rgba(13,20,40,0.98);
      padding:4px 7px;
      font-size:11px;
      color:var(--accent-soft);
      cursor:pointer;
    }

    .chat-messages{
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(3,6,18,0.96);
      padding:6px;
      max-height:160px;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:11px;
    }
    .chat-msg{
      padding:4px 6px;
      border-radius:8px;
      max-width:100%;
      white-space:pre-wrap;
      word-wrap:break-word;
      line-height:1.4;
    }
    .chat-msg.user{
      background:rgba(70,145,255,0.16);
      align-self:flex-end;
    }
    .chat-msg.assistant{
      background:rgba(255,193,119,0.14);
      align-self:flex-start;
    }
    .chat-msg.system{
      background:rgba(118,123,190,0.16);
      align-self:center;
      font-style:italic;
    }

    .chat-input-row{
      display:flex;
      gap:6px;
      margin-top:4px;
    }
    .chat-input-row textarea{
      flex:1;
      min-height:32px;
      max-height:64px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(5,9,22,0.98);
      padding:4px 6px;
      font-size:11px;
      color:var(--text-soft);
      resize:vertical;
    }
    .chat-input-row button{
      width:34px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.24);
      background:linear-gradient(135deg,#3ac3ff,#ffb35c);
      color:#050816;
      font-size:16px;
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .chat-helper{
      font-size:10px;
      color:var(--text-muted);
      margin-top:2px;
    }

    .app-footer{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      font-size:12px;
      color:var(--text-muted);
    }
    .footer-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .theme-card{
      flex:1 1 48%;
      border-radius:18px;
      background:rgba(10,13,30,0.96);
      border:1px solid rgba(255,255,255,0.12);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .theme-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--text-muted);
    }
    .theme-chips{
      display:flex;
      gap:6px;
    }
    .theme-chip{
      flex:1;
      padding:6px 8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.16);
      background:radial-gradient(circle at top, rgba(255,255,255,0.09), rgba(6,9,21,0.96));
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      cursor:pointer;
      transition:background .16s ease-out, border-color .18s ease-out, box-shadow .22s ease-out, transform .16s ease-out;
    }
    .theme-chip span.dot{
      width:9px;height:9px;border-radius:999px;
      background:linear-gradient(135deg,#3ac3ff,#8c7bff);
    }
    .theme-chip[data-theme="madeira"] span.dot{
      background:linear-gradient(135deg,#f3b05e,#8c5a2a);
    }
    .theme-chip.active{
      border-color:rgba(255,187,104,0.9);
      box-shadow:0 0 18px rgba(255,176,88,0.8);
      background:linear-gradient(135deg,rgba(255,169,86,0.35),rgba(13,10,4,0.98));
      transform:translateY(-1px);
    }
    .theme-chip:active{
      transform:scale(0.97) translateY(1px);
    }

    .hash-card{
      flex:1 1 48%;
      border-radius:18px;
      background:rgba(8,11,25,0.96);
      border:1px solid rgba(255,255,255,0.12);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .hash-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }
    .hash-title{
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--text-muted);
    }
    .hash-tag-pill{
      padding:3px 8px;
      border-radius:999px;
      border:1px dashed rgba(255,255,255,0.22);
      font-size:11px;
      color:var(--text-soft);
    }
    .hash-main{
      border-radius:12px;
      padding:7px 8px;
      background:rgba(7,10,22,0.98);
      border:1px dashed rgba(255,255,255,0.22);
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      font-size:11px;
      color:var(--text-soft);
    }

    .foot-note{
      font-size:11px;
      color:var(--text-muted);
      text-align:center;
      margin-top:4px;
    }
    .log{
      margin-top:4px;
      font-size:11px;
      color:var(--text-muted);
      line-height:1.4;
      text-align:center;
    }
    .log strong{color:var(--accent-warm);}

    /* ====== CAP/LOCAL C√ÅPSULAS ¬∑ Gerenciador de c√°psulas ====== */
    .capsule-manager{
      margin-top:10px;
      padding:8px 10px;
      border-radius:16px;
      background:rgba(8,11,25,0.94);
      border:1px solid rgba(171,189,255,0.24);
      box-shadow:0 8px 20px rgba(0,0,0,0.8);
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .capsule-manager .caps-row{
      display:flex;
    }

    .capsule-manager input,
    .capsule-manager textarea{
      width:100%;
      border:none;
      outline:none;
      border-radius:12px;
      padding:6px 10px;
      background:rgba(7,10,22,0.98);
      border:1px solid rgba(171,189,255,0.24);
      font-size:11px;
      color:var(--text-main);
      resize:vertical;
      min-height:34px;
      font-family:inherit;
    }

    .capsule-manager input::placeholder,
    .capsule-manager textarea::placeholder{
      color:var(--text-muted);
    }

    .capsule-manager textarea{
      min-height:68px;
    }

    .capsule-manager .caps-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .capsule-manager .caps-actions button{
      border:none;
      outline:none;
      border-radius:999px;
      padding:5px 11px;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.12em;
      cursor:pointer;
      transition:background .16s ease-out, border-color .16s ease-out, color .16s ease-out, box-shadow .18s ease-out, transform .12s ease-out;
      display:inline-flex;
      align-items:center;
      gap:4px;
      box-shadow:0 6px 14px rgba(0,0,0,0.8);
    }

    .capsule-manager .caps-actions button.primary{
      background:linear-gradient(135deg, rgba(116,182,255,0.85), rgba(255,193,146,0.85));
      color:#050816;
      border:1px solid rgba(255,210,150,0.9);
    }

    .capsule-manager .caps-actions button:not(.primary){
      background:rgba(7,10,22,0.96);
      color:var(--text-soft);
      border:1px solid rgba(171,189,255,0.32);
    }

    .capsule-manager .caps-actions button:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 24px rgba(0,0,0,0.9);
    }

    .capsule-manager .caps-actions button:active{
      transform:translateY(1px) scale(0.97);
      box-shadow:0 4px 10px rgba(0,0,0,0.85);
    }

    .capsule-manager .caps-hint{
      font-size:10px;
      color:var(--text-muted);
      padding-top:2px;
    }
  </style>
</head>
<body data-theme="nebula">
  <div class="app" id="app">
    <header class="app-header">
      <div class="brand-pill">Dual ¬∑ Infodose</div>
      <button class="mode-pill" type="button" id="modeBtn">
        <span class="dot"></span>
        <span>Modo 3¬∑6¬∑9 ativo</span>
      </button>
    </header>

    <main class="app-main">
      <!-- HERO -->
      <section class="hero-card">
        <div class="hero-top">
          <span class="hero-time" id="timeLeft">--:--</span>
          <button class="hero-voice" type="button" id="heroVoice" title="Ouvir resumo do dia">üîä</button>
        </div>
        <div>
          <div class="hero-title" id="heroGreeting">Bom dia, Dual</div>
          <div class="hero-subtitle" id="heroSubtitle">Sua dose de hoje j√° est√° organizada.</div>
        </div>
        <div class="hero-slider">
          <div class="hero-slider-row">
            <span class="hero-time">00h</span>
            <span class="label-mood" id="moodLabel"><i></i><span>Manh√£ focada</span></span>
            <span class="hero-time">23h</span>
          </div>
          <div class="range-wrap">
            <div class="range-track"></div>
            <div class="range-fill" id="rangeFill"></div>
            <!-- 24h -->
            <input class="hero-range" id="timeRange" type="range" min="0" max="23" step="1" value="12" />
          </div>
        </div>
      </section>

      <!-- STACKS -->
      <section class="stacks">
        <!-- Ativa√ß√µes -->
        <details class="stack" open>
          <summary class="stack-summary">
            <div class="stack-main">
              <div class="stack-title">Ativa√ß√µes de hoje</div>
              <div class="stack-sub">Escolha em 3 cliques onde entrar agora.</div>
            </div>
            <div class="stack-meta">
              <span class="stack-pill">Agora ¬∑ 25min</span>
              <div class="stack-icon">‚ö°</div>
            </div>
          </summary>
          <div class="stack-body">
            <ul class="panel-list">
              <li class="panel-row" data-log="Ativa√ß√£o r√°pida ¬∑ 25min agora">
                <div class="panel-row-main">
                  <strong>Agora ¬∑ 25min</strong>
                  <span class="meta">Micro sess√£o para destravar o dia.</span>
                </div>
                <span class="panel-pill"><i>‚ñ∂</i>Come√ßar</span>
              </li>
              <li class="panel-row" data-log="Janela de foco escolhida">
                <div class="panel-row-main">
                  <strong>Janela de foco</strong>
                  <span class="meta">Foco silencioso com trilha Infodose.</span>
                </div>
                <span class="panel-pill"><i>üéß</i>Entrar</span>
              </li>
              <li class="panel-row" data-log="Pausa suave para recarregar">
                <div class="panel-row-main">
                  <strong>Recarregar</strong>
                  <span class="meta">Respira, alonga, volta com 1% de inten√ß√£o.</span>
                </div>
                <span class="panel-pill"><i>‚ü≥</i>5min</span>
              </li>
            </ul>
          </div>
        </details>

        <!-- Organizar dia -->
        <details class="stack">
          <summary class="stack-summary">
            <div class="stack-main">
              <div class="stack-title">Organizar meu dia</div>
              <div class="stack-sub">Manh√£, tarde, noite ‚Äî sem n√≥ na cabe√ßa.</div>
            </div>
            <div class="stack-meta">
              <span class="stack-pill">Blocos 3¬∑6¬∑9</span>
              <div class="stack-icon secondary">‚Ä∫</div>
            </div>
          </summary>
          <div class="stack-body">
            <ul class="panel-list">
              <li class="panel-row" data-log="Organizar bloco da manh√£">
                <div class="panel-row-main">
                  <strong>Manh√£</strong>
                  <span class="meta">Escolha 1 coisa pra resolver antes do almo√ßo.</span>
                </div>
                <span class="panel-pill"><i>‚òÄÔ∏è</i>Definir</span>
              </li>
              <li class="panel-row" data-log="Organizar bloco da tarde">
                <div class="panel-row-main">
                  <strong>Tarde</strong>
                  <span class="meta">Bloco de entrega ‚Äî estudar, trabalhar, criar.</span>
                </div>
                <span class="panel-pill"><i>üå§</i>Planejar</span>
              </li>
              <li class="panel-row" data-log="Organizar bloco da noite">
                <div class="panel-row-main">
                  <strong>Noite</strong>
                  <span class="meta">Fechamento leve + 1 micro vit√≥ria pessoal.</span>
                </div>
                <span class="panel-pill"><i>üåô</i>Cuidar</span>
              </li>
            </ul>
            <div class="panel-row" style="margin-top:6px;" data-log="Ver painel geral do dia">
              <div class="panel-row-main">
                <strong>Resumo do dia</strong>
                <span class="meta">Ver tudo como um painel s√≥.</span>
              </div>
              <span class="panel-pill"><i>üìã</i>Ver painel</span>
            </div>
            <div class="stack-note">
              Escolha s√≥ um foco por per√≠odo. O resto vira mem√≥ria, n√£o cobran√ßa.
            </div>
          </div>
        </details>

        <!-- Arqu√©tipo -->
        <details class="stack">
          <summary class="stack-summary">
            <div class="stack-main">
              <div class="stack-title">Arqu√©tipo do dia</div>
              <div class="stack-sub">Resumo, √°udio e Aplicar 1% sem esfor√ßo.</div>
            </div>
            <div class="stack-meta">
              <span class="stack-pill">Base Madeira ¬∑ Criador</span>
              <div class="stack-icon secondary">‚óé</div>
            </div>
          </summary>
          <div class="stack-body">
            <ul class="panel-list">
              <li class="panel-row" data-log="Resumo do arqu√©tipo lido">
                <div class="panel-row-main">
                  <strong>Resumo ‚òÖ</strong>
                  <span class="meta">Arqu√©tipo do dia + palavra-chave.</span>
                </div>
                <span class="panel-pill"><i>‚ú®</i>Ver agora</span>
              </li>
              <li class="panel-row" id="btnArqTts">
                <div class="panel-row-main">
                  <strong>Ouvir ‚è±</strong>
                  <span class="meta">√Åudio curto explicando como usar hoje.</span>
                </div>
                <span class="panel-pill"><i>‚óé</i>Tocar</span>
              </li>
              <li class="panel-row" data-log="Inten√ß√£o 1% aplicada com arqu√©tipo">
                <div class="panel-row-main">
                  <strong>Aplicar 1%</strong>
                  <span class="meta">Uma micro a√ß√£o pr√°tica no mundo real.</span>
                </div>
                <span class="panel-pill"><i>‚ö°</i>Gerar 1%</span>
              </li>
            </ul>
          </div>
        </details>

        <!-- HUB SOLAR -->
        <details class="stack">
          <summary class="stack-summary">
            <div class="stack-main">
              <div class="stack-title">Hub Solar ¬∑ Nos.S¬∞lar</div>
              <div class="stack-sub">Status simb√≥lico do n√≥ + painel solar integrado.</div>
            </div>
            <div class="stack-meta">
              <span class="stack-pill">Luz ¬∑ Bateria ¬∑ Rede</span>
              <div class="stack-icon secondary">‚òÄÔ∏è</div>
            </div>
          </summary>
          <div class="stack-body">
            <div class="solar-grid" id="solarGrid">
              <div class="solar-card" data-kind="luz" data-state-index="0">
                <div class="solar-label">Luz</div>
                <div class="solar-state">
                  <span class="solar-dot"></span>
                  <span class="solar-icon">‚òÄÔ∏è</span>
                  <span class="solar-text">OK ¬∑ captando</span>
                </div>
              </div>
              <div class="solar-card" data-kind="bateria" data-state-index="0">
                <div class="solar-label">Bateria</div>
                <div class="solar-state">
                  <span class="solar-dot"></span>
                  <span class="solar-icon">üîã</span>
                  <span class="solar-text">OK ¬∑ 3¬∑6¬∑9</span>
                </div>
              </div>
              <div class="solar-card" data-kind="rede" data-state-index="0">
                <div class="solar-label">Rede</div>
                <div class="solar-state">
                  <span class="solar-dot"></span>
                  <span class="solar-icon">üì°</span>
                  <span class="solar-text">OK ¬∑ local</span>
                </div>
              </div>
            </div>

            <div class="solar-hash" id="solarHash">
              Hash Solar do dia: ‚Ä¶
            </div>

            <div class="panel-row" id="btnSolarPanel" data-log="Abrindo painel Nos.S¬∞lar no Hub">
              <div class="panel-row-main">
                <strong>Abrir painel Nos.S¬∞lar</strong>
                <span class="meta">Ver cards solares, n√≥s e or√°culos do sol.</span>
              </div>
              <span class="panel-pill"><i>‚òÄÔ∏è</i>Ver painel</span>
            </div>

            <div class="solar-viewer viewer-shell" id="solarViewer">
              <div class="viewer-header">
                <span class="viewer-header-title">Painel Nos.S¬∞lar</span>
                <button type="button" class="viewer-toggle" data-target="solarViewer">
                  <span class="icon">‚§¢</span><span class="label">Expandir</span>
                </button>
              </div>
              <div class="viewer-body" id="solarBody">
                <div class="solar-empty">
                  Toque em <strong>Abrir painel Nos.S¬∞lar</strong> para carregar
                  <code>https://kodux78k.github.io/NosSolar-dualInfodose/</code> aqui dentro.
                </div>
              </div>
            </div>

            <!-- CHAT SOLAR ¬∑ IA -->
            <div class="solar-chat">
              <div class="solar-chat-header">
                <div>
                  <div class="solar-chat-title">Assistente Solar ¬∑ Hub Chat</div>
                  <div>Organiza Hub1, Nos.S¬∞lar e seus 1% com IA.</div>
                </div>
                <div class="chat-config">
                  <select id="chatModel">
                    <option value="openrouter/auto">auto</option>
                    <option value="openai/gpt-4o-mini">gpt-4o-mini</option>
                    <option value="google/gemini-flash-1.5">gemini-flash</option>
                    <option value="mistralai/mistral-small">mistral-small</option>
                  </select>
                  <small>modelo</small>
                </div>
              </div>

              <div class="chat-system-box">
                <textarea id="chatSystemPrompt">Voc√™ √© o Assistente Solar do Hub1 / BlueCup / Nos.S¬∞lar.
Contexto:
- Home Dual.Infodose com stacks: Ativa√ß√µes, Organizar meu dia, Arqu√©tipo do dia, Hub Solar, Meus documentos.
- Hub Solar monitora Luz, Bateria e Rede de n√≥s solares simb√≥licos e abre o painel Nos.S¬∞lar em iframe.
- Meus documentos carrega c√°psulas de apps locais e externos (HTML, PWAs, livros vivos).

Instru√ß√µes:
- Responda sempre em portugu√™s, curto, direto e gentil.
- Use met√°foras de sol, bateria, rede e Base Madeira.
- Quando falar de c√≥digo ou HTML, d√™ exemplos simples que a pessoa possa colar direto no Hub.
- Sempre sugira 1 micro-a√ß√£o 3¬∑6¬∑9 no final.</textarea>
              </div>

              <div class="solar-chat-key">
                <input
                  type="password"
                  id="chatKey"
                  placeholder="Chave OpenRouter (sk-or-...)"
                  autocomplete="off"
                />
                <button type="button" id="chatSaveKey">‚óè</button>
              </div>

              <div class="chat-messages" id="chatMessages">
                <div class="chat-msg system">
                  Use este chat para perguntar sobre o Hub1, o Hub Solar, c√°psulas e pr√≥ximos passos 1%.
                </div>
              </div>

              <div class="chat-input-row">
                <textarea id="chatInput" placeholder="Pergunte algo pro Assistente Solar..."></textarea>
                <button type="button" id="chatSend">‚û§</button>
              </div>

              <div class="chat-helper">
                A chave fica s√≥ no navegador (localStorage). Endpoint: <code>openrouter.ai</code>.
              </div>
            </div>
          </div>
        </details>

        <!-- Meus documentos / Corpora√ß√£o C√°psula -->
        <details class="stack" id="stackDocs" open>
          <summary class="stack-summary">
            <div class="stack-main">
              <div class="stack-title">Meus documentos ¬∑ C√°psulas</div>
              <div class="stack-sub">Apps, livros vivos e PWAs em um lugar s√≥.</div>
            </div>
            <div class="stack-meta">
              <span class="stack-pill">apps.json ¬∑ viewer ¬∑ localStorage</span>
              <div class="stack-icon secondary">‚ñ∏</div>
            </div>
          </summary>
          <div class="stack-body">
            <div class="panel-row" data-log="Entrou em documentos r√°pidos">
              <div class="panel-row-main">
                <strong>Pastas r√°pidas</strong>
                <span class="meta">Use como rascunho mental, sem depender de drive.</span>
              </div>
            </div>

            <!-- GRID de c√°psulas -->
            <div class="pill-grid" id="appsGrid"></div>

            <div class="stack-note">
              Toque em uma c√°psula para abrir o app aqui embaixo, dentro do pr√≥prio Hub.  
              C√°psulas locais s√£o salvas no navegador e podem ser exportadas/importadas.
            </div>

            <!-- GERENCIADOR DE C√ÅPSULAS -->
            <div class="capsule-manager">
              <div class="caps-row">
                <input id="capTitle" placeholder="Nome da c√°psula (ex: Or√°culo Local)" />
              </div>
              <div class="caps-row">
                <textarea id="capContent" placeholder="Cole um link ou HTML do app (href/src ou URL)..."></textarea>
              </div>
              <div class="caps-actions">
                <button class="primary" type="button" id="capAdd">Salvar c√°psula</button>
                <button type="button" id="capExport">Exportar JSON</button>
                <button type="button" id="capImport">Importar JSON</button>
                <button type="button" id="capClear">Limpar locais</button>
              </div>
              <p class="caps-hint">
                Dica: pode colar o HTML inteiro do app; eu tento achar o primeiro <code>href</code> ou <code>src</code>.
              </p>
            </div>

            <div class="livro-viewer viewer-shell" id="livroViewer">
              <div class="viewer-header">
                <span class="viewer-header-title">Viewer de c√°psulas</span>
                <button type="button" class="viewer-toggle" data-target="livroViewer">
                  <span class="icon">‚§¢</span><span class="label">Expandir</span>
                </button>
              </div>
              <div class="viewer-body" id="livroBody">
                <div class="livro-empty">
                  Escolha uma das c√°psulas acima para abrir o app via <code>iframe</code> dentro do Hub1.
                </div>
              </div>
            </div>
          </div>
        </details>
      </section>
    </main>

    <footer class="app-footer">
      <div class="footer-row">
        <div class="theme-card">
          <div class="theme-title">Meus temas</div>
          <div class="theme-chips">
            <button class="theme-chip active" type="button" data-theme="nebula">
              <span class="dot"></span>
              <span>Nebula Pro</span>
            </button>
            <button class="theme-chip" type="button" data-theme="madeira">
              <span class="dot"></span>
              <span>Base Madeira</span>
            </button>
          </div>
        </div>

        <div class="hash-card">
          <div class="hash-header">
            <span class="hash-title">Hash do dia</span>
            <span class="hash-tag-pill">#markdown</span>
          </div>
          <div class="hash-main">
            Esquematize suas ideias em 3 blocos.<br/>
            1. O que √© hoje ¬∑ 2. O que voc√™ quer ¬∑ 3. Seu 1%.
          </div>
        </div>
      </div>

      <div class="foot-note">
        Toque em uma sess√£o, escolha 1% e deixe o resto com o Hub. ‚ú®
      </div>
      <div class="log" id="logBox">
        Toque em um card para ver o pr√≥ximo passo aqui embaixo.
      </div>
    </footer>
  </div>

  <script>
    (function(){
      const body = document.body;

      /* ====== SEED DE APPS (externos + locais) ====== */
      const SEED_APPS = [
        {
          key: "Orc",
          title: "üóíÔ∏è CostaRibeiro-Orc",
          desc: "PWA offline com dashboard, lembrete e relat.",
          icon: "icons/icon-180.png",
          url: "./apps/CostaRibeiro-ORc.html",
          origin: "seed"
        },
        {
          key: "CATCR",
          title: "CATCR",
          desc: "Regularize seu .",
          icon: "icons/icon-181.png",
          url: "./apps/CATCR.html",
          origin: "seed"
        },
        {
          key: "Contratos1",
          title: "üìë Cat√°logos",
          desc: "Gere or√ßamentos.",
          icon: "icons/icon-182.png",
          url: "./apps/CostaRibero-Cotar0.html",
          origin: "seed"
        },
        {
          key: "Cotas",
          title: "üìë Cat√°logos",
          desc: "Gere cat√°logos.",
          icon: "icons/icon-192.png",
          url: "./apps/CatCostaRibeiro.html",
          origin: "seed"
        },
        {
          key: "d0x-local",
          title: "üìú infoD0X",
          desc: "Livro vivo (local).",
          icon: "icons/icon-d0x.png",
          url: "./apps/index_final_cards_nossolar.html",
          origin: "seed"
        },
        {
          key: "ticos",
          title: "üóíÔ∏è Pr√°ticas ‚Äî NR10/NR35",
          desc: "PWA offline com dashboard e relatos com √°udio.",
          icon: "icons/icon-192.png",
          url: "./PWA_TICO_Ultra/index.html",
          origin: "seed"
        },
        {
          key: "dual-editor",
          title: "‚úèÔ∏è Dual Editor ‚Ä¢ Kodux",
          desc: "Editor vivo para c√≥digos, prompts e HTML Dual.",
          icon: "icons/icon-192.png",
          url: "https://kodux78k.github.io/Dual-Editor/",
          origin: "seed"
        },
        {
          key: "unouno-oraculo",
          title: "üåÄ UnoUno ‚Ä¢ Or√°culo Dual",
          desc: "Or√°culo simb√≥lico estilo HUB Uno, experimental.",
          icon: "icons/icon-192.png",
          url: "https://kodux78k.github.io/Unouno-/index.html",
          origin: "seed"
        },
        {
          key: "info-doc",
          title: "üìö Info-Doc ‚Ä¢ Livro Vivo",
          desc: "Leitor/organizador de livros vivos Infodose.",
          icon: "icons/icon-192.png",
          url: "https://kodux78k.github.io/info-Doc/index.html",
          origin: "seed"
        },
        {
          key: "nossolar-dual",
          title: "‚òÄÔ∏è Nos.S¬∞lar ‚Äì dual.infodose",
          desc: "Painel solar simb√≥lico com cards e rede Nos.S¬∞lar.",
          icon: "icons/icon-192.png",
          url: "https://kodux78k.github.io/NosSolar-dualInfodose/",
          origin: "seed"
        },
        {
          key: "dual-app",
          title: "üåê Dual App ‚Ä¢ Hub",
          desc: "App central Dual para experimentos de interface.",
          icon: "icons/icon-192.png",
          url: "https://kodux78k.github.io/dual-app/index.html",
          origin: "seed"
        },
        {
          key: "dual-splash",
          title: "‚ú® A.Dual.Infodose ‚Ä¢ Splash",
          desc: "Tela de abertura / splash ritual.",
          icon: "icons/icon-192.png",
          url: "https://kodux78k.github.io/A.Dual.Infodose/splash.html",
          origin: "seed"
        }
      ];

      /* ====== HERO / TEMPO (24h) ====== */
      const timeRange = document.getElementById('timeRange');
      const rangeFill = document.getElementById('rangeFill');
      const moodSpan = document.getElementById('moodLabel').querySelector('span');
      const heroGreeting = document.getElementById('heroGreeting');
      const heroSubtitle = document.getElementById('heroSubtitle');
      const timeLeft = document.getElementById('timeLeft');
      const heroVoice = document.getElementById('heroVoice');

      const moodForHour = (h) => {
        // 0‚Äì4 madrugada, 5‚Äì11 manh√£, 12‚Äì17 tarde, 18‚Äì23 noite
        if(h >= 5 && h < 12) return 'manha';
        if(h >= 12 && h < 18) return 'tarde';
        if(h >= 18 && h <= 23) return 'noite';
        return 'madrugada';
      };
      const moodText = {
        madrugada: 'Madrugada silenciosa',
        manha: 'Manh√£ focada',
        tarde: 'Tarde produtiva',
        noite: 'Noite tranquila'
      };

      function updateClock(){
        const now = new Date();
        timeLeft.textContent = now.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
      }
      function updateMood(h){
        const span = h / 23; // 0‚Äì23
        rangeFill.style.transform = `translateY(-50%) scaleX(${Math.max(0.03, span)})`;

        const mood = moodForHour(h);
        body.setAttribute('data-mood', mood);
        moodSpan.textContent = moodText[mood];

        let greeting = 'Bom dia, Dual';
        if(mood === 'tarde') greeting = 'Boa tarde, Dual';
        if(mood === 'noite') greeting = 'Boa noite, Dual';
        if(mood === 'madrugada') greeting = 'Boa madrugada, Dual';
        heroGreeting.textContent = greeting;

        if(mood === 'manha'){
          heroSubtitle.textContent = 'Sua dose de hoje j√° est√° organizada.';
        }else if(mood === 'tarde'){
          heroSubtitle.textContent = 'Vamos fechar a tarde com uma entrega clara.';
        }else if(mood === 'noite'){
          heroSubtitle.textContent = 'Hora de desacelerar sem largar os seus 1%.';
        }else{
          heroSubtitle.textContent = 'Se a mente t√° girando, a gente reduz pra 1% de cada vez.';
        }
      }
      function syncFromClock(){
        const now = new Date();
        let h = now.getHours(); // 0‚Äì23
        timeRange.value = h;
        updateMood(h);
        updateClock();
      }
      if(timeRange){
        timeRange.addEventListener('input', (e)=>{
          updateMood(parseInt(e.target.value, 10));
        });
      }
      syncFromClock();
      setInterval(updateClock, 60000);

      /* ====== TEMAS ====== */
      const themeChips = document.querySelectorAll('.theme-chip');
      function setTheme(theme){
        body.setAttribute('data-theme', theme);
        try{ localStorage.setItem('dual_theme', theme); }catch(e){}
      }
      themeChips.forEach(chip=>{
        chip.addEventListener('click', ()=>{
          themeChips.forEach(c=>c.classList.remove('active'));
          chip.addEventListener
          chip.classList.add('active');
          const t = chip.getAttribute('data-theme') || 'nebula';
          setTheme(t);
        });
      });
      try{
        const savedTheme = localStorage.getItem('dual_theme');
        if(savedTheme){
          setTheme(savedTheme);
          themeChips.forEach(c=>{
            if(c.getAttribute('data-theme') === savedTheme) c.classList.add('active');
            else c.classList.remove('active');
          });
        }else{
          setTheme('nebula');
        }
      }catch(e){
        setTheme('nebula');
      }

      /* ====== MODO 3¬∑6¬∑9 ====== */
      const modeBtn = document.getElementById('modeBtn');
      let modeOn = true;
      modeBtn.addEventListener('click', ()=>{
        modeOn = !modeOn;
        const span = modeBtn.querySelector('span:nth-child(2)');
        const dot = modeBtn.querySelector('.dot');
        if(modeOn){
          span.textContent = 'Modo 3¬∑6¬∑9 ativo';
          dot.style.background = '#60f7b3';
          dot.style.boxShadow = '0 0 10px rgba(96,247,179,0.9)';
        }else{
          span.textContent = 'Modo 3¬∑6¬∑9 em pausa';
          dot.style.background = '#ffb35c';
          dot.style.boxShadow = '0 0 10px rgba(255,179,92,0.9)';
        }
      });

      /* ====== SANFONA: um aberto por vez ====== */
      const stacks = document.querySelectorAll('details.stack');
      stacks.forEach(d=>{
        d.addEventListener('toggle', ()=>{
          if(!d.open) return;
          stacks.forEach(o=>{ if(o!==d) o.open=false; });
        });
      });

      /* ====== LOG ====== */
      const logBox = document.getElementById('logBox');
      function log(msg){
        const t = new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
        logBox.innerHTML = `[${t}] <strong>${msg}</strong>`;
      }
      document.querySelectorAll('.panel-row').forEach(el=>{
        const msg = el.getAttribute('data-log');
        if(!msg) return;
        el.addEventListener('click', ()=>log(msg));
      });

      /* ====== TTS ====== */
      const arqBtn = document.getElementById('btnArqTts');
      function speak(text){
        if(!('speechSynthesis' in window)) return;
        try{
          speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(text);
          u.lang = 'pt-BR';
          u.rate = 1.02;
          u.pitch = 1.0;
          speechSynthesis.speak(u);
        }catch(e){
          console.warn('TTS falhou', e);
        }
      }
      if(arqBtn){
        arqBtn.addEventListener('click', ()=>{
          speak(
            'Arqu√©tipo base de hoje: Madeira Criadora. ' +
            'Tradu√ß√£o simples: voc√™ n√£o precisa resolver tudo, s√≥ plantar algo pequeno que cresce. ' +
            'Escolha uma micro a√ß√£o que deixe o dia de hoje um pouco mais vivo.'
          );
          log('Lendo arqu√©tipo do dia em voz alta.');
        });
      }
      if(heroVoice){
        heroVoice.addEventListener('click', ()=>{
          speak(
            'Home Dual Infodose. Seu dia est√° organizado em blocos simples. ' +
            'Escolha uma ativa√ß√£o, um bloco de tempo, ou apenas escute o arqu√©tipo do dia. ' +
            'O importante √© s√≥ um por cento agora.'
          );
          log('Resumo do dia em voz lido em voz alta.');
        });
      }

      /* ====== HUB SOLAR: HASH E ESTADOS ====== */
      const solarHashEl = document.getElementById('solarHash');
      function computeSolarHash(){
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        const h = String(now.getHours()).padStart(2,'0');
        const base = `${y}${m}${d}${h}`;
        const tail = (now.getDay() * 3 + now.getHours()) % 9;
        return `NOS-${y}-${m}${d}-H${h}-K${tail}`;
      }
      if(solarHashEl){
        solarHashEl.textContent = 'Hash Solar do dia: ' + computeSolarHash();
      }

      const solarStates = [
        { label: 'OK', dot: 'var(--success)', text: 'OK ¬∑ est√°vel' },
        { label: 'Inst√°vel', dot: '#ffb35c', text: 'Inst√°vel ¬∑ observando' },
        { label: 'Desligado', dot: '#ff6b81', text: 'Offline ¬∑ cuidado' }
      ];
      const solarGrid = document.getElementById('solarGrid');
      if(solarGrid){
        solarGrid.querySelectorAll('.solar-card').forEach(card=>{
          card.addEventListener('click', ()=>{
            let idx = parseInt(card.getAttribute('data-state-index') || '0',10);
            idx = (idx + 1) % solarStates.length;
            card.setAttribute('data-state-index', String(idx));
            const st = solarStates[idx];
            const dot = card.querySelector('.solar-dot');
            const text = card.querySelector('.solar-text');
            if(dot){
              dot.style.background = st.dot;
              dot.style.boxShadow = `0 0 10px ${st.dot}`;
            }
            if(text){
              const kind = card.getAttribute('data-kind') || '';
              if(kind === 'luz'){
                text.textContent = st.label === 'OK'
                  ? 'OK ¬∑ captando'
                  : st.label === 'Inst√°vel'
                  ? 'Inst√°vel ¬∑ nublado'
                  : 'Desligado ¬∑ noite';
              }else if(kind === 'bateria'){
                text.textContent = st.label === 'OK'
                  ? 'OK ¬∑ 3¬∑6¬∑9'
                  : st.label === 'Inst√°vel'
                  ? 'Inst√°vel ¬∑ abaixo de 36%'
                  : 'Desligado ¬∑ proteger';
              }else if(kind === 'rede'){
                text.textContent = st.label === 'OK'
                  ? 'OK ¬∑ local'
                  : st.label === 'Inst√°vel'
                  ? 'Inst√°vel ¬∑ lat√™ncia'
                  : 'Offline ¬∑ n√≥ isolado';
              }else{
                text.textContent = st.text;
              }
            }
          });
        });
      }

      const solarBody = document.getElementById('solarBody');
      const btnSolarPanel = document.getElementById('btnSolarPanel');
      if(solarBody && btnSolarPanel){
        btnSolarPanel.addEventListener('click', ()=>{
          const url = 'https://kodux78k.github.io/NosSolar-dualInfodose/';
          solarBody.innerHTML = `<iframe src="${url}" loading="lazy" title="‚òÄÔ∏è Nos.S¬∞lar ‚Äì dual.infodose"></iframe>`;
          log('Abrindo painel Nos.S¬∞lar no Hub Solar.');
        });
      }

      /* ====== VIEWERS: bot√£o Expandir/Reduzir ====== */
      document.querySelectorAll('.viewer-toggle').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-target');
          const container = id ? document.getElementById(id) : null;
          if(!container) return;
          const expanded = container.classList.toggle('viewer-expanded');
          const labelSpan = btn.querySelector('.label');
          const iconSpan = btn.querySelector('.icon');
          if(labelSpan && iconSpan){
            if(expanded){
              labelSpan.textContent = 'Reduzir';
              iconSpan.textContent = '‚§°';
            }else{
              labelSpan.textContent = 'Expandir';
              iconSpan.textContent = '‚§¢';
            }
          }
        });
      });

      /* ====== CORPORA√á√ÉO C√ÅPSULA: appsGrid + localStorage ====== */
      const livroViewer = document.getElementById('livroViewer');
      const livroBody = document.getElementById('livroBody');
      const appsGrid = document.getElementById('appsGrid');
      const docsStack = document.getElementById('stackDocs');

      let userApps = [];
      let appsRendered = false;

      function loadUserApps(){
        try{
          const raw = localStorage.getItem('dual_capsules');
          if(raw){
            const arr = JSON.parse(raw);
            if(Array.isArray(arr)) userApps = arr;
          }
        }catch(e){
          userApps = [];
        }
      }
      function saveUserApps(){
        try{
          localStorage.setItem('dual_capsules', JSON.stringify(userApps));
        }catch(e){}
      }

      function extractUrl(text){
        if(!text) return null;
        const trimmed = text.trim();
        if(!trimmed) return null;

        const firstToken = trimmed.split(/\s+/)[0];
        if(/^https?:\/\//i.test(firstToken) ||
           firstToken.startsWith('./') ||
           firstToken.startsWith('../') ||
           firstToken.startsWith('/')){
          return firstToken;
        }
        const m = trimmed.match(/<(iframe|a)[^>]+?(src|href)="([^"]+)"/i);
        if(m) return m[3];
        return null;
      }

      function getAllApps(){
        const locals = (userApps || []).map((app, idx)=>({
          ...app,
          origin: 'local',
          key: app.key || `local-${idx}`
        }));
        return [...SEED_APPS, ...locals];
      }

      function renderApps(){
        if(!appsGrid) return;
        appsRendered = true;
        appsGrid.innerHTML = '';
        const all = getAllApps();
        all.forEach((app, idx)=>{
          if(!app || !app.url) return;
          const pill = document.createElement('div');
          pill.className = 'pill';
          pill.dataset.url = app.url;
          pill.dataset.origin = app.origin || 'seed';
          pill.dataset.index = String(idx);

          const isLocal = app.origin === 'local';

          pill.innerHTML = `
            <div class="pill-main">
              <div class="pill-title">${app.title || app.key || 'C√°psula'}</div>
              <div class="pill-desc">${app.desc || ''}</div>
            </div>
            <div class="pill-actions">
              <span class="pill-badge">${isLocal ? 'local' : 'seed'}</span>
              ${isLocal ? '<button class="pill-del" type="button" title="Apagar c√°psula local">√ó</button>' : ''}
            </div>
          `;

          pill.addEventListener('click', (ev)=>{
            const delBtn = ev.target.closest('.pill-del');
            if(delBtn && isLocal){
              const localsStart = SEED_APPS.length;
              const overallIdx = idx;
              const localIdx = overallIdx - localsStart;
              if(localIdx >= 0 && localIdx < userApps.length){
                const removed = userApps.splice(localIdx,1);
                saveUserApps();
                renderApps();
                log('C√°psula removida: ' + (removed[0]?.title || 'local'));
              }
              ev.stopPropagation();
              return;
            }

            const url = app.url;
            const title = app.title || app.key || url;
            if(livroBody){
              livroBody.innerHTML = `
                <iframe src="${url}" loading="lazy" title="${title}"></iframe>
              `;
            }
            log('Abrindo c√°psula: ' + title);
          });

          appsGrid.appendChild(pill);
        });

        // se nada selecionado ainda, mant√©m mensagem default
        if(livroBody && !livroBody.querySelector('iframe')){
          livroBody.innerHTML = `
            <div class="livro-empty">
              Escolha uma das c√°psulas acima para abrir o app via <code>iframe</code> dentro do Hub1.
            </div>
          `;
        }
      }

      loadUserApps();

      // renderiza apps imediatamente
      renderApps();

      // lazy: tamb√©m renderiza quando abrir "Meus documentos" (caso n√£o esteja open inicialmente)
      if(docsStack){
        docsStack.addEventListener('toggle', ()=>{
          if(docsStack.open && !appsRendered){
            renderApps();
          }
        });
      }

      /* GERENCIADOR: criar, exportar, importar, limpar */
      const capTitle = document.getElementById('capTitle');
      const capContent = document.getElementById('capContent');
      const capAdd = document.getElementById('capAdd');
      const capExport = document.getElementById('capExport');
      const capImport = document.getElementById('capImport');
      const capClear = document.getElementById('capClear');

      if(capAdd){
        capAdd.addEventListener('click', ()=>{
          const title = (capTitle.value || '').trim() || 'C√°psula local';
          const raw = capContent.value || '';
          const url = extractUrl(raw);
          if(!url){
            alert('N√£o achei nenhum link ou URL v√°lido. Cole um href/src ou uma URL.');
            return;
          }
          const app = {
            key: `local-${Date.now()}`,
            title,
            desc: 'c√°psula local',
            url,
            origin: 'local'
          };
          userApps.push(app);
          saveUserApps();
          renderApps();
          capContent.value = '';
          log('C√°psula salva: ' + title);
        });
      }

      if(capExport){
        capExport.addEventListener('click', async ()=>{
          const json = JSON.stringify(userApps, null, 2);
          let ok = false;
          try{
            await navigator.clipboard.writeText(json);
            ok = true;
            alert('JSON de c√°psulas copiado para a √°rea de transfer√™ncia.');
          }catch(e){}
          if(!ok){
            const txt = prompt('Copie o JSON das c√°psulas:', json);
            if(txt !== null){
              // s√≥ mostrar
            }
          }
        });
      }

      if(capImport){
        capImport.addEventListener('click', ()=>{
          const raw = prompt('Cole aqui o JSON de c√°psulas locais:');
          if(!raw) return;
          try{
            const arr = JSON.parse(raw);
            if(Array.isArray(arr)){
              userApps = arr.map(a=>({ ...a, origin:'local' }));
              saveUserApps();
              renderApps();
              log('C√°psulas importadas com sucesso.');
            }else{
              alert('JSON n√£o √© uma lista.');
            }
          }catch(e){
            alert('JSON inv√°lido.');
          }
        });
      }

      if(capClear){
        capClear.addEventListener('click', ()=>{
          if(!confirm('Apagar todas as c√°psulas locais? (Seed permanece)')) return;
          userApps = [];
          saveUserApps();
          if(appsRendered) renderApps();
          log('Todas as c√°psulas locais foram limpas.');
        });
      }

      /* ====== CHAT SOLAR ¬∑ OPENROUTER multi-model ====== */
      const chatMessages = document.getElementById('chatMessages');
      const chatInput = document.getElementById('chatInput');
      const chatSend = document.getElementById('chatSend');
      const chatKeyInput = document.getElementById('chatKey');
      const chatSaveKey = document.getElementById('chatSaveKey');
      const chatModelSelect = document.getElementById('chatModel');
      const chatSystemPrompt = document.getElementById('chatSystemPrompt');

      let chatTurns = [];

      function appendMsg(role, text){
        if(!chatMessages) return;
        const div = document.createElement('div');
        div.className = 'chat-msg ' + role;
        div.textContent = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function getSystemPrompt(){
        const txt = (chatSystemPrompt?.value || '').trim();
        if(txt) return txt;
        return 'Voc√™ √© um assistente solar simples para o Hub1.';
      }

      try{
        const savedKey = localStorage.getItem('dual_openrouter_key');
        if(savedKey && chatKeyInput) chatKeyInput.value = savedKey;

        const savedModel = localStorage.getItem('dual_chat_model');
        if(savedModel && chatModelSelect){
          chatModelSelect.value = savedModel;
        }

        const savedPrompt = localStorage.getItem('dual_chat_prompt');
        if(savedPrompt && chatSystemPrompt){
          chatSystemPrompt.value = savedPrompt;
        }
      }catch(e){}

      if(chatSaveKey && chatKeyInput){
        chatSaveKey.addEventListener('click', ()=>{
          const v = chatKeyInput.value.trim();
          try{
            if(v){
              localStorage.setItem('dual_openrouter_key', v);
              appendMsg('system','Chave OpenRouter salva localmente neste navegador.');
            }else{
              localStorage.removeItem('dual_openrouter_key');
              appendMsg('system','Chave OpenRouter removida do navegador.');
            }
          }catch(e){
            console.warn('Erro ao salvar chave', e);
          }
        });
      }
      if(chatModelSelect){
        chatModelSelect.addEventListener('change', ()=>{
          try{
            localStorage.setItem('dual_chat_model', chatModelSelect.value);
          }catch(e){}
        });
      }
      if(chatSystemPrompt){
        chatSystemPrompt.addEventListener('change', ()=>{
          try{
            localStorage.setItem('dual_chat_prompt', chatSystemPrompt.value);
          }catch(e){}
        });
      }

      async function sendChat(){
        if(!chatInput || !chatMessages || !chatKeyInput || !chatModelSelect) return;
        const key = chatKeyInput.value.trim();
        if(!key){
          alert('Informe sua chave OpenRouter (sk-or-...) para usar o chat.');
          return;
        }
        const text = chatInput.value.trim();
        if(!text) return;

        appendMsg('user', text);
        chatTurns.push({ role:'user', content:text });
        chatInput.value = '';

        appendMsg('assistant','...');
        const loadingBubble = chatMessages.lastElementChild;

        const systemPrompt = getSystemPrompt();
        const messages = [
          { role:'system', content:systemPrompt },
          ...chatTurns
        ];

        const model = chatModelSelect.value || 'openrouter/auto';

        try{
          const res = await fetch('https://openrouter.ai/api/v1/chat/completions',{
            method:'POST',
            headers:{
              'Authorization':'Bearer ' + key,
              'Content-Type':'application/json',
              'HTTP-Referer':'https://dual.infodose.local',
              'X-Title':'Hub1 Solar Chat'
            },
            body:JSON.stringify({
              model,
              messages,
              stream:false
            })
          });

          if(!res.ok){
            loadingBubble.textContent = 'Erro ' + res.status + ' ao chamar OpenRouter.';
            return;
          }
          const data = await res.json();
          const msg = data.choices?.[0]?.message?.content || '(sem resposta)';
          loadingBubble.textContent = msg;
          chatTurns.push({ role:'assistant', content:msg });
        }catch(err){
          console.error(err);
          loadingBubble.textContent = 'Falha na requisi√ß√£o (cheque rede / CORS).';
        }
      }

      if(chatSend){
        chatSend.addEventListener('click', sendChat);
      }
      if(chatInput){
        chatInput.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter' && !e.shiftKey){
            e.preventDefault();
            sendChat();
          }
        });
      }

      /* ====== REGISTRO DO SERVICE WORKER ====== */
      if('serviceWorker' in navigator){
        window.addEventListener('load', ()=>{
          navigator.serviceWorker.register('./sw.js').catch((err)=>{
            console.warn('SW falhou:', err);
          });
        });
      }
    })();
  </script>
</body>
</html>